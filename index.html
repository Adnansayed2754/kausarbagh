<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Masjid-e-Kausar | Kausar Bagh, Pune</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:ital,wght@0,400;0,700;1,400&family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['"Plus Jakarta Sans"', 'sans-serif'],
                        arabic: ['"Amiri"', 'serif'],
                    },
                    colors: {
                        emerald: { 50: '#ecfdf5', 100: '#d1fae5', 500: '#10b981', 600: '#059669', 700: '#047857', 900: '#064e3b' }
                    },
                    borderRadius: { '4xl': '2.5rem' }
                }
            }
        }
    </script>

    <style>
        [x-cloak] { display: none !important; }
        .glass-panel { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(12px); border-bottom: 1px solid rgba(0, 0, 0, 0.05); }
        .glass-panel-dark { background: rgba(15, 23, 42, 0.85); backdrop-filter: blur(16px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .hero-parallax {
            background-image: linear-gradient(to bottom, rgba(15, 23, 42, 0.6), rgba(15, 23, 42, 0.8)), url('https://images.unsplash.com/photo-1590076215667-875d4ef2d97e?q=80&w=1600');
            background-position: center; background-size: cover;
        }
    </style>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    
    <script>
        document.addEventListener('alpine:init', () => {
            Alpine.data('mosqueApp', () => ({
                scrolled: false,
                mobileMenuOpen: false,
                hijriDate: 'Calculating...',
                salahList: [
                    { name: 'Fajr', time24: '05:30', timeFormatted: '5:30 AM', jamaatFormatted: '5:45 AM' },
                    { name: 'Dhuhr', time24: '12:45', timeFormatted: '12:45 PM', jamaatFormatted: '1:00 PM' },
                    { name: 'Asr', time24: '16:30', timeFormatted: '4:30 PM', jamaatFormatted: '4:45 PM' },
                    { name: 'Maghrib', time24: '18:40', timeFormatted: '6:40 PM', jamaatFormatted: '6:55 PM' },
                    { name: 'Isha', time24: '20:00', timeFormatted: '8:00 PM', jamaatFormatted: '8:15 PM' }
                ],
                nextPrayer: null,
                timeUntilNext: '',
                dailyDua: { arabic: "رَبَّنَا آتِنَا فِي الدُّنْيَا حَسَنَةً", english: "Our Lord, give us in this world [that which is] good.", surah: "Al-Baqarah", ayahNumber: "201" },
                loadingAnnouncements: true,
                filteredAnnouncements: [],
                
                // MAIN TAB (Announcements)
                sheetUrl: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vS-qU7Ue-vY9o7z3D-l_2Kj-y7Xh7z7z7z7z7z7z7z7z7z7z7z7z7z7z7z7z7z7z7z7z7z/pub?output=csv', 

                async init() {
                    window.addEventListener('scroll', () => this.scrolled = window.pageYOffset > 20);
                    
                    // 1. Try to fetch announcements first
                    await this.fetchAnnouncements();
                    
                    // 2. Fetch Prayers (Optional enhancement - keep defaults for safety)
                    this.updateTimer();
                    setInterval(() => this.updateTimer(), 1000);
                },

                async fetchAnnouncements() {
                    this.loadingAnnouncements = true;
                    // Replace this with your ACTUAL Published CSV Link
                    const realSheetUrl = 'https://docs.google.com/spreadsheets/d/1ZZ_sof5kBwd_NuuQdFA6x38uwAWSqVdw2VkAuCcQGm4/export?format=csv&gid=586902215';
                    
                    Papa.parse(realSheetUrl, {
                        download: true,
                        header: true,
                        complete: (results) => {
                            const today = new Date();
                            today.setHours(0, 0, 0, 0);

                            // We look at the data based on indices 0, 1, 2, 3 as per your form structure
                            this.filteredAnnouncements = results.data
                                .filter(row => {
                                    const vals = Object.values(row);
                                    const title = vals[1]; // Column 2: Title
                                    const expiryRaw = vals[3]; // Column 4: Expiry
                                    
                                    if (!title || title.trim() === "") return false;
                                    if (!expiryRaw || expiryRaw.trim() === "") return true;

                                    const expiryDate = new Date(expiryRaw);
                                    if (isNaN(expiryDate.getTime())) return true;
                                    
                                    expiryDate.setHours(23, 59, 59, 999);
                                    return expiryDate >= today;
                                })
                                .map(row => {
                                    const vals = Object.values(row);
                                    return {
                                        date: vals[0] ? new Date(vals[0]).toLocaleDateString() : 'Today',
                                        title: vals[1],
                                        description: vals[2]
                                    }
                                })
                                .reverse();
                            
                            // If sheet is empty, add a demo one so it's not blank
                            if(this.filteredAnnouncements.length === 0) {
                                this.filteredAnnouncements = [{
                                    date: 'System',
                                    title: 'Welcome to Masjid-e-Kausar',
                                    description: 'Please check back later for community updates and events.'
                                }];
                            }
                            this.loadingAnnouncements = false;
                        },
                        error: (err) => {
                            console.error("Sheet Error:", err);
                            this.loadingAnnouncements = false;
                        }
                    });
                },

                updateTimer() {
                    const now = new Date();
                    const nowMin = now.getHours() * 60 + now.getMinutes();
                    
                    let next = this.salahList.find(p => {
                        const [h, m] = p.time24.split(':').map(Number);
                        return (h * 60 + m) > nowMin;
                    });

                    if (!next) next = { ...this.salahList[0], isTomorrow: true };
                    this.nextPrayer = next;

                    const [nh, nm] = next.time24.split(':').map(Number);
                    let diff = (nh * 60 + nm) - nowMin;
                    if (next.isTomorrow) diff += 1440;

                    const h = Math.floor(diff / 60);
                    const m = diff % 60;
                    this.timeUntilNext = `${h}h ${m}m`;
                },

                isNextPrayer(name) {
                    return this.nextPrayer && this.nextPrayer.name === name;
                }
            }));
        });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
</head>

<body class="bg-slate-50 text-slate-900 font-sans antialiased" x-data="mosqueApp()" x-cloak>

    <!-- Nav -->
    <nav class="fixed w-full z-50 glass-panel transition-all" :class="scrolled ? 'py-2 shadow-md' : 'py-4'">
        <div class="max-w-7xl mx-auto px-4 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-emerald-600 text-white rounded-full flex items-center justify-center text-xl">
                    <i class="fa-solid fa-mosque"></i>
                </div>
                <span class="font-bold text-xl text-emerald-900">Masjid-e-Kausar</span>
            </div>
            
            <div class="hidden lg:flex items-center space-x-6">
                <a href="#prayers" class="hover:text-emerald-600 font-medium">Salah Times</a>
                <a href="#announcements" class="hover:text-emerald-600 font-medium">Announcements</a>
                <a href="#location" class="hover:text-emerald-600 font-medium">Location</a>
                <a href="https://maps.app.goo.gl/YourGoogleMapsLink" target="_blank" class="bg-emerald-600 text-white px-5 py-2 rounded-full font-semibold text-sm">Get Directions</a>
            </div>

            <button @click="mobileMenuOpen = !mobileMenuOpen" class="lg:hidden text-emerald-900">
                <i class="fa-solid fa-bars text-2xl"></i>
            </button>
        </div>
    </nav>

    <!-- Hero -->
    <header class="hero-parallax min-h-[70vh] flex items-center pt-20">
        <div class="max-w-7xl mx-auto px-4 w-full grid lg:grid-cols-2 gap-12 items-center">
            <div>
                <h1 class="text-5xl md:text-7xl font-bold text-white mb-6">Masjid-e-Kausar</h1>
                <p class="text-lg text-slate-200 mb-8 max-w-lg">Kausar Bagh, Kondhwa, Pune. A place for spiritual growth and community service.</p>
                <div class="flex flex-wrap gap-4">
                    <a href="#prayers" class="bg-emerald-600 text-white px-8 py-3 rounded-full font-bold shadow-lg">View Times</a>
                    <a href="https://maps.app.goo.gl/YourGoogleMapsLink" target="_blank" class="bg-white/10 backdrop-blur-md text-white border border-white/20 px-8 py-3 rounded-full font-bold">Get Directions</a>
                </div>
            </div>

            <div class="lg:ml-auto w-full max-w-md">
                <div class="glass-panel-dark rounded-4xl p-8 border border-white/10 shadow-2xl text-center">
                    <template x-if="nextPrayer">
                        <div>
                            <h3 class="text-emerald-400 font-bold uppercase text-xs tracking-widest mb-2">Next Prayer</h3>
                            <div class="text-5xl font-bold text-white mb-2" x-text="nextPrayer.name"></div>
                            <div class="text-2xl text-emerald-100 mb-4">Jamaat at <span class="text-white font-bold" x-text="nextPrayer.jamaatFormatted"></span></div>
                            <div class="inline-block px-6 py-2 rounded-full bg-emerald-500/20 text-emerald-300 font-medium">
                                Adhan in <span x-text="timeUntilNext"></span>
                            </div>
                        </div>
                    </template>
                </div>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 py-16 space-y-20">

        <!-- Prayer Times -->
        <section id="prayers">
            <div class="text-center mb-10">
                <h2 class="text-3xl font-bold text-slate-900">Daily Salah Schedule</h2>
                <p class="text-slate-500">Jamaat is set to 15 minutes after Adhan</p>
            </div>

            <div class="grid grid-cols-1 sm:grid-cols-3 lg:grid-cols-5 gap-4">
                <template x-for="prayer in salahList" :key="prayer.name">
                    <div class="bg-white rounded-3xl p-6 shadow-sm border border-slate-200 text-center transition-all"
                         :class="{ 'ring-2 ring-emerald-500 bg-emerald-50': isNextPrayer(prayer.name) }">
                        <h3 class="text-lg font-bold text-slate-900 mb-3" x-text="prayer.name"></h3>
                        <div class="space-y-2">
                            <div class="bg-slate-50 rounded-xl p-2">
                                <span class="text-[10px] uppercase font-bold text-slate-400 block">Adhan</span>
                                <span class="text-lg font-bold text-slate-700" x-text="prayer.timeFormatted"></span>
                            </div>
                            <div class="bg-emerald-600 rounded-xl p-2 text-white">
                                <span class="text-[10px] uppercase font-bold text-emerald-200 block">Jamaat</span>
                                <span class="text-lg font-bold" x-text="prayer.jamaatFormatted"></span>
                            </div>
                        </div>
                    </div>
                </template>
            </div>
        </section>

        <!-- Dua Section -->
        <section id="dua" class="bg-slate-900 rounded-4xl p-10 text-white text-center relative overflow-hidden">
            <div class="relative z-10">
                <span class="text-emerald-400 font-bold uppercase tracking-widest text-xs mb-6 block">Daily Reminder</span>
                <p class="font-arabic text-3xl md:text-4xl mb-6 leading-relaxed" x-text="dailyDua.arabic"></p>
                <p class="text-lg text-slate-300 italic mb-4" x-text="'&ldquo;' + dailyDua.english + '&rdquo;'"></p>
                <div class="text-emerald-500 text-sm" x-text="dailyDua.surah + ' : ' + dailyDua.ayahNumber"></div>
            </div>
        </section>

        <!-- Announcements -->
        <section id="announcements">
            <div class="mb-10">
                <h2 class="text-3xl font-bold text-slate-900">Announcements</h2>
            </div>
            <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                <template x-for="(item, index) in filteredAnnouncements" :key="index">
                    <div class="bg-white rounded-3xl p-6 shadow-sm border border-slate-200">
                        <div class="flex justify-between mb-4">
                            <div class="bg-emerald-50 text-emerald-600 p-2 rounded-lg"><i class="fa-solid fa-bullhorn"></i></div>
                            <span class="text-xs text-slate-400 font-bold" x-text="item.date"></span>
                        </div>
                        <h3 class="text-lg font-bold text-slate-900 mb-2" x-text="item.title"></h3>
                        <p class="text-slate-600 text-sm" x-text="item.description"></p>
                    </div>
                </template>
                <template x-if="loadingAnnouncements">
                    <div class="col-span-full py-10 text-center"><i class="fa-solid fa-spinner fa-spin text-2xl text-emerald-500"></i></div>
                </template>
            </div>
        </section>

        <!-- Location & Map -->
        <section id="location">
            <div class="text-center mb-10">
                <h2 class="text-3xl font-bold text-slate-900">Find Us</h2>
                <p class="text-slate-500">Kausar Bagh, Kondhwa, Pune, Maharashtra 411048</p>
            </div>
            <div class="grid lg:grid-cols-3 gap-8 items-start">
                <div class="lg:col-span-2 rounded-4xl overflow-hidden shadow-lg h-96 border border-slate-200">
                    <!-- Embedded Google Map -->
                    <iframe 
                        src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3784.442!2d73.89!3d18.48!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x3bc2c1df63967813%3A0x6739665f80b8529d!2sMasjid%20E%20Kausar!5e0!3m2!1sen!2sin!4v1710000000000!5m2!1sen!2sin" 
                        width="100%" height="100%" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade">
                    </iframe>
                </div>
                <div class="bg-white p-8 rounded-4xl border border-slate-200 shadow-sm">
                    <h3 class="text-xl font-bold mb-4">Visiting Hours</h3>
                    <p class="text-slate-600 text-sm mb-6">Open for all five daily prayers and Friday Jumu'ah service.</p>
                    <div class="space-y-4">
                        <div class="flex items-center gap-3">
                            <i class="fa-solid fa-location-dot text-emerald-600"></i>
                            <span class="text-sm font-medium">Kausar Bagh, Pune</span>
                        </div>
                        <div class="flex items-center gap-3">
                            <i class="fa-solid fa-phone text-emerald-600"></i>
                            <span class="text-sm font-medium">+91 20 1234 5678</span>
                        </div>
                    </div>
                    <a href="https://maps.app.goo.gl/YourGoogleMapsLink" target="_blank" class="mt-8 block text-center bg-emerald-600 text-white py-3 rounded-full font-bold">Get Directions</a>
                </div>
            </div>
        </section>

    </main>

    <footer class="bg-slate-900 py-10 text-slate-500 text-center text-sm">
        <p>&copy; 2026 Masjid-e-Kausar, Pune. All rights reserved.</p>
    </footer>

</body>
</html>
